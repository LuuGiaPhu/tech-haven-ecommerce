<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= product.name %> - TECH HAVEN</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/product_detail.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- Firebase App (the core Firebase SDK) -->
    <script type="module" src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js"></script>
</head>
<body class="product-detail-page">
    <!-- Header with Navigation -->
    <header class="header">
        <nav class="navbar">
            <div class="nav-brand">
                <h1><a href="/" style="text-decoration: none; color: inherit;">TECH HAVEN</a></h1>
            </div>
            
            <!-- Mobile Menu Toggle -->
            <div class="mobile-menu-toggle">
                <i class="fas fa-bars"></i>
            </div>
            
            <div class="nav-menu">
                <a href="/">TRANG CHỦ</a>
                <a href="/shop">CỬA HÀNG</a>
                <div class="admin-dropdown">
                    <a href="#" class="dropdown-toggle">ADMIN <i class="fas fa-chevron-down"></i></a>
                    <div class="dropdown-menu">
                        <a href="/admin/input">INPUT</a>
                        <a href="/admin/edit">EDIT</a>
                    </div>
                </div>
                <a href="/laptops">LAPTOP</a>
                <a href="/components">LINH KIỆN</a>
                <a href="/peripherals">PHỤ KIỆN</a>
                <a href="/build-pc" class="build-btn">XÂY DỰNG PC</a>
                <div class="mobile-nav-icons">
                    <a href="#" onclick="toggleSearch()"><i class="fas fa-search"></i> Tìm kiếm</a>
                    <a href="#" onclick="toggleCart()"><i class="fas fa-shopping-cart"></i> Giỏ hàng (<span id="cartCount">0</span>)</a>
                    <a href="#"><i class="fas fa-user"></i> Tài khoản</a>
                </div>
            </div>
            <div class="nav-icons">
                <i class="fas fa-search" onclick="toggleSearch()"></i>
                <div class="cart-icon-wrapper" onclick="toggleCart()">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="cart-badge" id="cartBadge">0</span>
                </div>
                <i class="fas fa-user"></i>
            </div>
        </nav>
    </header>

    <!-- Product Detail Content -->
    <div class="product-detail-content">
        <div class="product-container">
            <!-- Breadcrumb -->
            <nav class="breadcrumb">
                <a href="/"><i class="fas fa-home"></i></a>
                <span class="separator"><i class="fas fa-chevron-right"></i></span>
                <a href="/shop">Cửa hàng</a>
                <span class="separator"><i class="fas fa-chevron-right"></i></span>
                <a href="/shop?category=<%= product.category %>"><%= product.category %></a>
                <span class="separator"><i class="fas fa-chevron-right"></i></span>
                <span class="current"><%= product.name %></span>
            </nav>

            <!-- Product Detail Grid -->
            <div class="product-detail-grid" data-product-id="<%= product.id %>">
                <!-- Product Gallery -->
                <div class="product-gallery">
                    <div class="main-image">
                        <% if (product.images && product.images[0]) { %>
                            <img src="<%= product.images[0] %>" alt="<%= product.name %>">
                        <% } else { %>
                            <i class="fas fa-laptop"></i>
                        <% } %>
                    </div>
                    <div class="thumbnail-gallery">
                        <% if (product.images && product.images.length > 0) { %>
                            <% product.images.forEach((image, index) => { %>
                                <div class="thumbnail">
                                    <i class="fas fa-laptop"></i>
                                </div>
                            <% }); %>
                        <% } else { %>
                            <div class="thumbnail">
                                <i class="fas fa-laptop"></i>
                            </div>
                            <div class="thumbnail">
                                <i class="fas fa-laptop"></i>
                            </div>
                            <div class="thumbnail">
                                <i class="fas fa-laptop"></i>
                            </div>
                        <% } %>
                    </div>
                </div>

                <!-- Product Info -->
                <div class="product-info">
                    <% if (product.availability === 'Còn hàng') { %>
                        <div class="product-badge">Còn hàng</div>
                    <% } %>
                    
                    <h1 class="product-title"><%= product.name %></h1>
                    
                    <div class="product-rating">
                        <div class="stars">
                            <% for (let i = 1; i <= 5; i++) { %>
                                <% if (i <= product.rating) { %>
                                    <i class="fas fa-star"></i>
                                <% } else { %>
                                    <i class="far fa-star"></i>
                                <% } %>
                            <% } %>
                        </div>
                        <span class="rating-text">(<%= product.reviewCount || 0 %> đánh giá)</span>
                    </div>
                    
                    <div class="product-price">
                        <span class="current-price"><%= new Intl.NumberFormat('vi-VN').format(product.price) %> VNĐ</span>
                        <% if (product.oldPrice && product.oldPrice > product.price) { %>
                            <span class="old-price"><%= new Intl.NumberFormat('vi-VN').format(product.oldPrice) %> VNĐ</span>
                            <span class="discount-badge">
                                -<%= Math.round(((product.oldPrice - product.price) / product.oldPrice) * 100) %>%
                            </span>
                        <% } %>
                    </div>
                    
                    <div class="product-meta">
                        <div class="meta-item">
                            <span class="meta-label">Tình trạng:</span>
                            <span class="meta-value availability <%= product.availability === 'Còn hàng' ? 'in-stock' : 'out-of-stock' %>">
                                <%= product.availability || 'Còn hàng' %>
                            </span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">SKU:</span>
                            <span class="meta-value"><%= product.sku || 'N/A' %></span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Thương hiệu:</span>
                            <span class="meta-value"><%= product.brand || 'N/A' %></span>
                        </div>
                    </div>
                    
                    <div class="product-description">
                        <p><%= product.description || 'Mô tả sản phẩm sẽ được cập nhật sớm.' %></p>
                    </div>
                    
                    <div class="product-actions">
                        <div class="quantity-selector">
                            <span class="quantity-label">Số lượng:</span>
                            <div class="quantity-controls">
                                <button class="quantity-btn decrease">-</button>
                                <input type="number" class="quantity-input" value="1" min="1" max="99">
                                <button class="quantity-btn increase">+</button>
                            </div>
                        </div>
                        
                        <div class="action-buttons">
                            <button class="add-to-cart-btn">
                                <i class="fas fa-cart-plus"></i>
                                Thêm vào giỏ hàng
                            </button>
                            <button class="buy-now-btn">
                                <i class="fas fa-bolt"></i>
                                Mua ngay
                            </button>
                            <button class="wishlist-btn">
                                <i class="far fa-heart"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Product Tabs -->
            <div class="product-tabs">
                <div class="tab-headers">
                    <div class="tab-header active">Thông số kỹ thuật</div>
                    <div class="tab-header">Tính năng nổi bật</div>
                    <div class="tab-header">Đánh giá</div>
                </div>
                
                <div class="tab-content active">
                    <div class="specs-grid">
                        <% if (product.specifications) { %>
                            <% Object.entries(product.specifications).forEach(([key, value]) => { %>
                                <div class="spec-item">
                                    <span class="spec-label">
                                        <%= key === 'cpu' ? 'CPU' :
                                            key === 'gpu' ? 'Card đồ họa' :
                                            key === 'ram' ? 'RAM' :
                                            key === 'storage' ? 'Ổ cứng' :
                                            key === 'display' ? 'Màn hình' :
                                            key === 'ports' ? 'Cổng kết nối' :
                                            key === 'audio' ? 'Âm thanh' :
                                            key === 'keyboard' ? 'Bàn phím' :
                                            key === 'battery' ? 'Pin' :
                                            key === 'os' ? 'Hệ điều hành' :
                                            key === 'dimensions' ? 'Kích thước' :
                                            key === 'weight' ? 'Trọng lượng' :
                                            key %>:
                                    </span>
                                    <span class="spec-value"><%= value %></span>
                                </div>
                            <% }); %>
                        <% } else { %>
                            <div class="spec-item">
                                <span class="spec-label">Thông số:</span>
                                <span class="spec-value">Đang cập nhật...</span>
                            </div>
                        <% } %>
                    </div>
                </div>
                
                <div class="tab-content">
                    <div class="features-list">
                        <% if (product.features && product.features.length > 0) { %>
                            <% product.features.forEach(feature => { %>
                                <div class="feature-item">
                                    <div class="feature-icon">
                                        <i class="fas fa-check"></i>
                                    </div>
                                    <div class="feature-text"><%= feature %></div>
                                </div>
                            <% }); %>
                        <% } else { %>
                            <div class="feature-item">
                                <div class="feature-icon">
                                    <i class="fas fa-star"></i>
                                </div>
                                <div class="feature-text">Tính năng nổi bật sẽ được cập nhật sớm</div>
                            </div>
                        <% } %>
                    </div>
                </div>
                
                <div class="tab-content">
                    <div class="reviews-section">
                        <div class="reviews-summary">
                            <h3>Đánh giá từ khách hàng</h3>
                            <div class="rating-summary">
                                <div class="average-rating">
                                    <span class="rating-number"><%= product.rating || 5 %>.0</span>
                                    <div class="stars">
                                        <% for (let i = 1; i <= 5; i++) { %>
                                            <% if (i <= (product.rating || 5)) { %>
                                                <i class="fas fa-star"></i>
                                            <% } else { %>
                                                <i class="far fa-star"></i>
                                            <% } %>
                                        <% } %>
                                    </div>
                                    <span class="review-count">(<%= product.reviewCount || 152 %> đánh giá)</span>
                                </div>
                            </div>
                        </div>
                        <div class="review-placeholder">
                            <p style="text-align: center; color: #666; padding: 2rem;">
                                <i class="fas fa-comments" style="font-size: 3rem; margin-bottom: 1rem; display: block;"></i>
                                Tính năng đánh giá chi tiết sẽ sớm được cập nhật!
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Related Products -->
            <div class="related-products">
                <h2 class="section-title">Sản phẩm liên quan</h2>
                <div class="related-container">
                    <button class="nav-btn prev-btn" id="prevBtn">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <div class="products-wrapper">
                        <div class="products-track" id="productsTrack">
                            <% if (product.relatedProducts && product.relatedProducts.length > 0) { %>
                                <% product.relatedProducts.forEach(relatedProduct => { %>
                                    <div class="product-item" data-product-id="<%= relatedProduct.id %>">
                                        <div class="product-image">
                                            <% if (relatedProduct.image) { %>
                                                <img src="<%= relatedProduct.image %>" alt="<%= relatedProduct.name %>">
                                            <% } else { %>
                                                <i class="fas fa-laptop"></i>
                                            <% } %>
                                        </div>
                                        <h4 class="product-name"><%= relatedProduct.name %></h4>
                                        <p class="product-price">
                                            <%= new Intl.NumberFormat('vi-VN').format(relatedProduct.price) %> VNĐ
                                        </p>
                                    </div>
                                <% }); %>
                            <% } else { %>
                                <div class="product-item" data-product-id="2">
                                    <div class="product-image">
                                        <img src="/images/laptop.jpg" alt="MSI Katana 17 B13V">
                                    </div>
                                    <h4 class="product-name">MSI Katana 17 B13V</h4>
                                    <p class="product-price">28.990.000 VNĐ</p>
                                </div>
                                <div class="product-item" data-product-id="3">
                                    <div class="product-image">
                                        <img src="/images/laptop.jpg" alt="Acer Predator Helios 300">
                                    </div>
                                    <h4 class="product-name">Acer Predator Helios 300</h4>
                                    <p class="product-price">32.990.000 VNĐ</p>
                                </div>
                                <div class="product-item" data-product-id="4">
                                    <div class="product-image">
                                        <img src="/images/laptop.jpg" alt="HP Omen 16-k0000">
                                    </div>
                                    <h4 class="product-name">HP Omen 16-k0000</h4>
                                    <p class="product-price">26.990.000 VNĐ</p>
                                </div>
                                <div class="product-item" data-product-id="5">
                                    <div class="product-image">
                                        <i class="fas fa-desktop"></i>
                                    </div>
                                    <h4 class="product-name">Gaming Desktop PC</h4>
                                    <p class="product-price">45.990.000 VNĐ</p>
                                </div>
                                <div class="product-item" data-product-id="6">
                                    <div class="product-image">
                                        <i class="fas fa-memory"></i>
                                    </div>
                                    <h4 class="product-name">RTX 4070 Graphics Card</h4>
                                    <p class="product-price">18.990.000 VNĐ</p>
                                </div>
                            <% } %>
                        </div>
                    </div>
                    <button class="nav-btn next-btn" id="nextBtn">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <div class="footer-logo">
                    <i class="fas fa-microchip"></i>
                    <span>TECH HAVEN</span>
                </div>
                <p>Điểm đến tin cậy cho mọi nhu cầu công nghệ của bạn. Chất lượng hàng đầu, dịch vụ tận tâm.</p>
                <div class="social-icons">
                    <a href="#"><i class="fab fa-facebook"></i></a>
                    <a href="#"><i class="fab fa-twitter"></i></a>
                    <a href="#"><i class="fab fa-instagram"></i></a>
                    <a href="#"><i class="fab fa-youtube"></i></a>
                </div>
            </div>
            <div class="footer-section">
                <h4>Sản phẩm</h4>
                <ul>
                    <li><a href="/desktops">Máy tính để bàn</a></li>
                    <li><a href="/laptops">Laptop</a></li>
                    <li><a href="/components">Linh kiện</a></li>
                    <li><a href="/peripherals">Phụ kiện</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h4>Dịch vụ</h4>
                <ul>
                    <li><a href="/build-pc">Xây dựng PC</a></li>
                    <li><a href="#">Bảo hành</a></li>
                    <li><a href="#">Hỗ trợ kỹ thuật</a></li>
                    <li><a href="#">Giao hàng</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h4>Liên hệ</h4>
                <div class="contact-info">
                    <p><i class="fas fa-phone"></i> 1800-1234</p>
                    <p><i class="fas fa-envelope"></i> info@techhaven.vn</p>
                    <p><i class="fas fa-map-marker-alt"></i> 123 Tech Street, Hà Nội</p>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2024 Tech Haven. Tất cả quyền được bảo lưu.</p>
        </div>
    </footer>

    <!-- Search Overlay -->
    <div class="search-overlay" id="searchOverlay">
        <div class="search-container">
            <div class="search-header">
                <h3>Tìm kiếm sản phẩm</h3>
                <button class="search-close" onclick="toggleSearch()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Nhập từ khóa tìm kiếm...">
                <button class="search-btn">
                    <i class="fas fa-search"></i>
                </button>
            </div>
            <div class="search-suggestions" id="searchSuggestions">
                <!-- Search suggestions will be populated here -->
            </div>
        </div>
    </div>

    <!-- Cart Sidebar -->
    <div class="cart-sidebar" id="cartSidebar">
        <div class="cart-header">
            <h3><i class="fas fa-shopping-cart"></i> Giỏ Hàng</h3>
            <button class="cart-close" onclick="toggleCart()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="cart-items" id="cartItems">
            <div class="empty-cart">
                <i class="fas fa-shopping-cart" style="font-size: 3rem; color: #ccc; margin-bottom: 1rem;"></i>
                <p>Giỏ hàng của bạn đang trống</p>
                <small>Thêm sản phẩm để bắt đầu mua sắm</small>
            </div>
        </div>
        <div class="cart-footer">
            <div class="cart-total">
                <strong>Tổng: <span id="cartTotal">0 VNĐ</span></strong>
            </div>
            <button class="checkout-btn" id="checkoutBtn" onclick="proceedToCheckout()" disabled>
                <i class="fas fa-credit-card"></i> Thanh Toán
            </button>
        </div>
    </div>

    <!-- Cart Overlay -->
    <div class="cart-overlay" id="cartOverlay"></div>

    <!-- Scripts -->
    <script src="/js/script.js"></script>
    <script src="/js/product_detail.js"></script>
    
    <!-- Firebase Configuration and Services -->
    <script type="module" src="/js/firebase-config.js"></script>
    <script type="module" src="/js/firebase-services.js"></script>
</body>
</html>

<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="format-detection" content="telephone=no">
    <title>ThÃªm Sáº£n Pháº©m - TECH HAVEN Admin</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/images/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
    <link rel="manifest" href="/images/site.webmanifest">
    
    <!-- Google Fonts for Vietnamese Support -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Roboto:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- Lottie Animation Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js"></script>
    
    <!-- Firebase App (the core Firebase SDK) -->
    <script type="module" src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js"></script>
    
    <!-- Firebase Compat for Tier Monitoring -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    
    <!-- Initialize Firebase Compat for tier-promotion-manager.js -->
    <script>
        // Firebase configuration for compat version
        const firebaseCompatConfig = {
            apiKey: "AIzaSyC5mYAuZl_qs-5QnVGe55o6XxxUnlVSLCU",
            authDomain: "tech-haven-5368b.firebaseapp.com",
            projectId: "tech-haven-5368b",
            storageBucket: "tech-haven-5368b.firebasestorage.app",
            messagingSenderId: "442337591630",
            appId: "1:442337591630:web:a90d20afe92b1b0d5e48b8",
            measurementId: "G-NPQN4PCEN0"
        };
        
        // Initialize Firebase Compat (for tier-promotion-manager.js)
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseCompatConfig);
            console.log('âœ… Firebase Compat initialized for tier monitoring');
        }
    </script>
    
    <!-- Tier Promotion Manager - Global tier monitoring across all pages -->
    <script src="/js/tier-promotion-manager.js"></script>
    
    <style>
        /* ========================================
           CUTE & DYNAMIC ANIMATIONS
           ======================================== */
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes bounceIn {
            0% {
                opacity: 0;
                transform: scale(0.3);
            }
            50% {
                opacity: 1;
                transform: scale(1.05);
            }
            70% {
                transform: scale(0.9);
            }
            100% {
                transform: scale(1);
            }
        }
        
        @keyframes shimmer {
            0% {
                background-position: -1000px 0;
            }
            100% {
                background-position: 1000px 0;
            }
        }
        
        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }
        
        @keyframes slideOutRight {
            0% {
                transform: translateX(0);
                opacity: 1;
            }
            100% {
                transform: translateX(100px);
                opacity: 0;
            }
        }
        
        @keyframes confettiFall {
            0% {
                transform: translateY(-10px) rotate(0deg);
                opacity: 1;
            }
            50% {
                transform: translateY(50vh) rotate(180deg);
                opacity: 0.8;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }
        
        /* Global cute styles */
        body.admin-input-page {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }
        
        /* Floating background decorations */
        body.admin-input-page::before {
            content: 'âœ¨';
            position: fixed;
            top: 10%;
            left: 5%;
            font-size: 60px;
            opacity: 0.3;
            animation: float 6s ease-in-out infinite;
            z-index: 0;
        }
        
        body.admin-input-page::after {
            content: 'ðŸŽ¨';
            position: fixed;
            bottom: 10%;
            right: 5%;
            font-size: 80px;
            opacity: 0.3;
            animation: float 8s ease-in-out infinite reverse;
            z-index: 0;
        }
        
        /* Variant Management Styles */
        .variant-controls {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            border: 3px solid #fbbf24;
            box-shadow: 0 8px 25px rgba(251, 191, 36, 0.3);
            animation: fadeInUp 0.6s ease;
            position: relative;
            overflow: hidden;
        }
        
        .variant-controls::before {
            content: 'ðŸŽ¯';
            position: absolute;
            top: -15px;
            right: -15px;
            font-size: 100px;
            opacity: 0.1;
            transform: rotate(15deg);
        }
        
        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            font-weight: 600;
            color: #92400e;
            transition: all 0.3s ease;
            padding: 10px;
            border-radius: 12px;
        }
        
        .checkbox-label:hover {
            background: rgba(251, 191, 36, 0.2);
            transform: translateX(5px);
        }
        
        .checkbox-label input[type="checkbox"] {
            width: 22px;
            height: 22px;
            accent-color: #f59e0b;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        
        .checkbox-label input[type="checkbox"]:checked {
            animation: pulse 0.5s ease;
        }
        
        .parent-product-info .info-card {
            display: flex;
            align-items: center;
            gap: 15px;
            background: linear-gradient(135deg, #e0e7ff 0%, #f0f4ff 100%);
            border: 3px solid #c7d2fe;
            border-radius: 20px;
            padding: 20px;
            margin-top: 15px;
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.2);
            animation: bounceIn 0.6s ease;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .info-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, rgba(99, 102, 241, 0.1), transparent);
            border-radius: 50%;
            animation: float 10s ease-in-out infinite;
        }
        
        .info-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(99, 102, 241, 0.3);
        }
        
        .info-card i {
            color: #4f46e5;
            font-size: 32px;
            animation: pulse 2s ease-in-out infinite;
        }
        
        .info-content h4 {
            margin: 0 0 8px 0;
            color: #1f2937;
            font-size: 18px;
            font-weight: 700;
        }
        
        .info-content p {
            margin: 0 0 5px 0;
            font-weight: 600;
            color: #4f46e5;
        }
        
        .info-content small {
            color: #6b7280;
            font-size: 13px;
        }
        
        #variantActions {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        .create-variant-btn, .view-variants-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 14px 24px;
            border-radius: 16px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .create-variant-btn::before,
        .view-variants-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s ease;
        }
        
        .create-variant-btn:hover::before,
        .view-variants-btn:hover::before {
            left: 100%;
        }
        
        .create-variant-btn:hover, .view-variants-btn:hover {
            transform: translateY(-4px) scale(1.05);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.5);
        }
        
        .create-variant-btn:active,
        .view-variants-btn:active {
            transform: translateY(-2px) scale(1.02);
        }
        
        .create-variant-btn i,
        .view-variants-btn i {
            font-size: 18px;
            animation: pulse 2s ease-in-out infinite;
        }
        
        .view-variants-btn {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        
        .view-variants-btn:hover {
            box-shadow: 0 10px 30px rgba(16, 185, 129, 0.5);
        }
        
        .variant-form {
            background: linear-gradient(135deg, #ffffff 0%, #f9fafb 100%);
            border: 3px solid #e5e7eb;
            border-radius: 20px;
            padding: 0;
            margin-top: 25px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            animation: bounceIn 0.6s ease;
            transition: all 0.3s ease;
        }
        
        .variant-form:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
            border-color: #c7d2fe;
        }
        
        .variant-form-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 18px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            overflow: hidden;
        }
        
        .variant-form-header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            animation: shimmer 3s infinite;
        }
        
        .variant-form-header h4 {
            margin: 0;
            font-size: 18px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
            z-index: 1;
        }
        
        .variant-form-header h4 i {
            animation: pulse 2s ease-in-out infinite;
        }
        
        .close-variant-form {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            z-index: 1;
        }
        
        .close-variant-form:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg) scale(1.1);
        }
        
        .close-variant-form:active {
            transform: rotate(90deg) scale(0.95);
        }
        
        .variant-specific-fields {
            padding: 25px;
        }
        
        .variant-attributes {
            background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid #e5e7eb;
            box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.05);
            margin-top: 20px;
        }
        
        .variant-attributes h5 {
            margin: 0 0 15px 0;
            color: #374151;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .attribute-row {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 18px;
            margin-bottom: 12px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }
        
        .attribute-row:hover {
            border-color: #c7d2fe;
            transform: translateX(5px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
        }
        
        .attribute-row .form-row {
            align-items: flex-end;
            margin-bottom: 0;
        }
        
        .remove-attr-btn {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            border: 2px solid #fca5a5;
            color: #dc2626;
            padding: 10px 14px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            margin-left: 10px;
            height: fit-content;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.2);
        }
        
        .remove-attr-btn:hover {
            background: linear-gradient(135deg, #fecaca 0%, #fca5a5 100%);
            border-color: #f87171;
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 6px 18px rgba(220, 38, 38, 0.3);
        }
        
        .remove-attr-btn:active {
            transform: translateY(-1px) scale(1.0);
        }
        
        .add-attr-btn {
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            color: #059669;
            padding: 10px 15px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            margin-top: 10px;
        }
        
        .add-attr-btn:hover {
            background: #dcfce7;
            border-color: #86efac;
        }
        
        .variant-attr-name, .variant-attr-value {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }
        
        .variant-attr-name:focus, .variant-attr-value:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        /* Multiple Variant Forms Styles */
        .multiple-variant-forms {
            background: #ffffff;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            overflow: hidden;
        }
        
        .variant-forms-container {
            max-height: 600px;
            overflow-y: auto;
            padding: 0;
            border-radius: 15px;
        }
        
        .single-variant-form {
            border-bottom: 2px solid #e5e7eb;
            padding: 25px;
            position: relative;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #ffffff 0%, #fafbfc 100%);
        }
        
        .single-variant-form:hover {
            background: linear-gradient(135deg, #fafbfc 0%, #f3f4f6 100%);
        }
        
        .single-variant-form:last-child {
            border-bottom: none;
        }
        
        .variant-form-title {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px 16px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 15px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .variant-form-title::before {
            content: 'ðŸŽ¯';
            font-size: 18px;
        }
        
        .submit-variants-btn {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 16px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            margin-top: 25px;
        }
        
        .submit-variants-btn:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 12px 35px rgba(16, 185, 129, 0.4);
        }
        
        .submit-variants-btn:active {
            transform: translateY(-2px) scale(1.0);
        }
        
        .submit-variants-btn i {
            animation: pulse 2s ease-in-out infinite;
        }
        
        /* Variant Image Upload Styles */
        .variant-image-section {
            background: linear-gradient(135deg, #f0fdf4 0%, #d1fae5 100%);
            border: 3px solid #bbf7d0;
            border-radius: 15px;
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.15);
            transition: all 0.3s ease;
            padding: 20px;
            margin: 20px 0;
        }
        
        .variant-image-section:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(16, 185, 129, 0.25);
        }
        
        .variant-image-section h5 {
            margin: 0 0 15px 0;
            color: #059669;
            font-size: 18px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .variant-image-section h5::before {
            content: 'ðŸ“¸';
            font-size: 22px;
        }
        
        .variant-image-upload-area {
            border: 3px dashed #10b981;
            border-radius: 15px;
            padding: 35px;
            text-align: center;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            background: white;
            margin-top: 15px;
            position: relative;
            overflow: hidden;
        }
        
        .variant-image-upload-area::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(16, 185, 129, 0.1), transparent);
            transform: translate(-50%, -50%);
            transition: width 0.6s ease, height 0.6s ease;
        }
        
        .variant-image-upload-area:hover::before {
            width: 400px;
            height: 400px;
        }
        
        .variant-image-upload-area:hover {
            border-color: #059669;
            background: linear-gradient(135deg, #f0fdf4 0%, #d1fae5 100%);
            transform: scale(1.02);
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.25);
        }
        
        .variant-upload-icon {
            font-size: 3.5rem;
            color: #10b981;
            margin-bottom: 15px;
            animation: float 3s ease-in-out infinite;
            position: relative;
            z-index: 1;
        }
        
        .variant-image-upload-area p {
            margin: 5px 0;
            color: #374151;
        }
        
        .variant-image-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
        }
        
        .variant-preview-item {
            position: relative;
            aspect-ratio: 1;
            border-radius: 8px;
            overflow: hidden;
            border: 2px solid #d1fae5;
            transition: all 0.3s ease;
        }
        
        .variant-preview-item:hover {
            border-color: #10b981;
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }
        
        .variant-preview-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .variant-remove-image {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(239, 68, 68, 0.9);
            color: white;
            border: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            transition: all 0.3s ease;
        }
        
        .variant-remove-image:hover {
            background: #dc2626;
            transform: scale(1.1);
        }
        
        .use-main-images-option {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 2px solid #fbbf24;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 4px 15px rgba(251, 191, 36, 0.2);
            transition: all 0.3s ease;
        }
        
        .use-main-images-option:hover {
            transform: translateX(5px);
            box-shadow: 0 6px 20px rgba(251, 191, 36, 0.3);
        }
        
        .use-main-images-option label {
            color: #92400e;
            font-weight: 600;
            cursor: pointer;
        }
        
        /* Form Inputs Global Styles */
        .form-input,
        input[type="text"],
        input[type="number"],
        input[type="email"],
        input[type="tel"],
        select,
        textarea {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 15px;
            transition: all 0.3s ease;
            background: white;
            font-family: inherit;
        }
        
        .form-input:focus,
        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.15);
            transform: translateY(-2px);
        }
        
        .form-input:hover,
        input:hover,
        select:hover,
        textarea:hover {
            border-color: #c7d2fe;
        }
        
        textarea {
            resize: vertical;
            min-height: 120px;
        }
        
        /* Labels */
        label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
            position: relative;
            padding-left: 12px;
        }
        
        label::before {
            content: 'â–¸';
            position: absolute;
            left: 0;
            color: #667eea;
            font-size: 14px;
        }
        
        /* Submit Button */
        button[type="submit"],
        .submit-btn {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 16px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
        }
        
        button[type="submit"]::before,
        .submit-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s ease;
        }
        
        button[type="submit"]:hover::before,
        .submit-btn:hover::before {
            left: 100%;
        }
        
        button[type="submit"]:hover,
        .submit-btn:hover {
            transform: translateY(-4px) scale(1.05);
            box-shadow: 0 12px 35px rgba(16, 185, 129, 0.4);
        }
        
        button[type="submit"]:active,
        .submit-btn:active {
            transform: translateY(-2px) scale(1.02);
        }
        
        /* Form Sections */
        .form-section,
        .image-upload-section,
        .specs-section {
            background: linear-gradient(135deg, #ffffff 0%, #f9fafb 100%);
            border: 3px solid #e5e7eb;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
            animation: fadeInUp 0.6s ease;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .form-section::before {
            content: 'âœ¨';
            position: absolute;
            top: -15px;
            right: -15px;
            font-size: 100px;
            opacity: 0.05;
            transform: rotate(-15deg);
        }
        
        .form-section:hover,
        .image-upload-section:hover,
        .specs-section:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.12);
            border-color: #c7d2fe;
        }
        
        .form-section h3,
        .image-upload-section h3,
        .specs-section h3 {
            color: #374151;
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-section h3::before {
            content: 'ðŸ“';
            font-size: 24px;
        }
        
        .image-upload-section h3::before {
            content: 'ðŸ“¸';
            font-size: 24px;
        }
        
        .specs-section h3::before {
            content: 'âš™ï¸';
            font-size: 24px;
        }
        
        /* Image Upload Area */
        .image-upload-area {
            border: 3px dashed #c7d2fe;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
            position: relative;
            overflow: hidden;
        }
        
        .image-upload-area::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(102, 126, 234, 0.1), transparent);
            transform: translate(-50%, -50%);
            transition: width 0.6s ease, height 0.6s ease;
        }
        
        .image-upload-area:hover::before {
            width: 400px;
            height: 400px;
        }
        
        .image-upload-area:hover {
            border-color: #667eea;
            background: linear-gradient(135deg, #f0f4ff 0%, #e0e7ff 100%);
            transform: scale(1.02);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.2);
        }
        
        .upload-icon {
            font-size: 4rem;
            color: #667eea;
            margin-bottom: 20px;
            animation: float 3s ease-in-out infinite;
            position: relative;
            z-index: 1;
        }
        
        .upload-text {
            position: relative;
            z-index: 1;
        }
        
        .upload-text h4 {
            margin: 0 0 10px 0;
            color: #374151;
            font-size: 20px;
            font-weight: 700;
        }
        
        .upload-text p {
            margin: 0;
            color: #6b7280;
            font-size: 14px;
        }
        
        /* Image Preview */
        .image-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 20px;
            padding: 20px;
            background: linear-gradient(135deg, #f9fafb 0%, #ffffff 100%);
            border-radius: 15px;
            border: 2px solid #e5e7eb;
        }
        
        .preview-item {
            position: relative;
            aspect-ratio: 1;
            border-radius: 12px;
            overflow: hidden;
            border: 2px solid #e5e7eb;
            transition: all 0.3s ease;
            animation: bounceIn 0.5s ease;
        }
        
        .preview-item:hover {
            border-color: #667eea;
            transform: scale(1.05) rotate(2deg);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
            z-index: 10;
        }
        
        .preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .remove-image-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            border: 2px solid white;
            color: white;
            padding: 6px 8px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 12px;
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
        }
        
        .remove-image-btn:hover {
            transform: rotate(90deg) scale(1.2);
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
        }
        
        /* Progress Bar */
        .upload-progress {
            margin-top: 20px;
            background: #f3f4f6;
            border-radius: 12px;
            overflow: hidden;
            height: 30px;
            border: 2px solid #e5e7eb;
            position: relative;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 50%, #667eea 100%);
            background-size: 200% 100%;
            animation: shimmer 2s linear infinite;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 14px;
        }
        
        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 12px;
            font-weight: 600;
            color: #374151;
            z-index: 2;
            background: rgba(255, 255, 255, 0.9);
            padding: 2px 8px;
            border-radius: 4px;
            white-space: nowrap;
        }
        
        /* Spec Inputs */
        .spec-inputs {
            margin-bottom: 20px;
        }
        
        .spec-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            align-items: flex-end;
            animation: fadeInUp 0.4s ease;
        }
        
        .spec-row > div {
            flex: 1;
        }
        
        .add-spec-btn {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            border: none;
            padding: 14px 24px;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 6px 20px rgba(245, 158, 11, 0.3);
        }
        
        .add-spec-btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 10px 30px rgba(245, 158, 11, 0.4);
        }
        
        .add-spec-btn i {
            animation: pulse 2s ease-in-out infinite;
        }
        
        .remove-spec-btn {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            border: none;
            color: white;
            padding: 12px 16px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
        }
        
        .remove-spec-btn:hover {
            transform: translateY(-3px) scale(1.1);
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
        }
        
        /* Features Section */
        .features-section {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border: 2px solid #0ea5e9;
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
            box-shadow: 0 10px 40px rgba(14, 165, 233, 0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .features-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #0ea5e9 0%, #06b6d4 50%, #0ea5e9 100%);
            background-size: 200% 100%;
            animation: shimmer 2s ease-in-out infinite;
        }
        
        .features-section:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 60px rgba(14, 165, 233, 0.2);
        }
        
        .features-section h3 {
            color: #0c4a6e;
            margin-bottom: 25px;
            font-size: 1.4rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
        }
        
        .features-section h3 i {
            color: #0ea5e9;
            font-size: 1.6rem;
            text-shadow: 0 2px 4px rgba(14, 165, 233, 0.3);
        }
        
        .features-section h3::before {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 0;
            width: 60px;
            height: 3px;
            background: linear-gradient(90deg, #0ea5e9 0%, #06b6d4 100%);
            border-radius: 2px;
        }
        
        .feature-inputs {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .feature-row {
            display: flex;
            gap: 15px;
            align-items: center;
            background: rgba(255, 255, 255, 0.7);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid rgba(14, 165, 233, 0.2);
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            opacity: 0;
            transform: translateX(-20px);
        }
        
        .feature-row:hover {
            transform: translateX(10px);
            box-shadow: 0 8px 25px rgba(14, 165, 233, 0.15);
            border-color: #0ea5e9;
        }
        
        .feature-row .form-group {
            flex: 1;
            margin: 0;
        }
        
        .feature-row input[type="text"] {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid rgba(14, 165, 233, 0.3);
            border-radius: 12px;
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.9);
            transition: all 0.3s ease;
        }
        
        .feature-row input[type="text"]:focus {
            border-color: #0ea5e9;
            box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.1);
            background: white;
        }
        
        .add-feature-btn {
            background: linear-gradient(135deg, #0ea5e9 0%, #06b6d4 100%);
            border: none;
            color: white;
            padding: 16px 32px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(14, 165, 233, 0.3);
            display: flex;
            align-items: center;
            gap: 10px;
            align-self: flex-start;
        }
        
        .add-feature-btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 10px 30px rgba(14, 165, 233, 0.4);
        }
        
        .add-feature-btn i {
            animation: pulse 2s ease-in-out infinite;
        }
        
        .remove-feature-btn {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            border: none;
            color: white;
            padding: 12px 16px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
        }
        
        .remove-feature-btn:hover {
            transform: translateY(-3px) scale(1.1);
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
        }
        
        /* Message boxes */
        .message {
            padding: 20px 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            display: flex;
            align-items: flex-start;
            gap: 15px;
            animation: bounceIn 0.5s ease;
            font-weight: 600;
            position: relative;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .message:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.15);
        }
        
        .message-content {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            flex: 1;
        }
        
        .message-text {
            display: flex;
            flex-direction: column;
            gap: 10px;
            flex: 1;
        }
        
        .message-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .btn-success-action {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-success-action:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
        }
        
        .btn-close-message {
            background: rgba(0, 0, 0, 0.1);
            border: none;
            color: currentColor;
            padding: 8px;
            border-radius: 50%;
            cursor: pointer;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            position: absolute;
            top: 15px;
            right: 15px;
        }
        
        .btn-close-message:hover {
            background: rgba(0, 0, 0, 0.2);
            transform: scale(1.1);
        }
        
        .message.success {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            border: 2px solid #10b981;
            color: #065f46;
        }
        
        .message.error {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            border: 2px solid #ef4444;
            color: #991b1b;
        }
        
        .message i {
            font-size: 24px;
            margin-top: 2px;
        }
        
        /* Admin Header */
        .admin-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .admin-header::before {
            content: 'ðŸŽ¨';
            position: absolute;
            top: -30px;
            right: -30px;
            font-size: 150px;
            opacity: 0.1;
            transform: rotate(-15deg);
            animation: float 10s ease-in-out infinite;
        }
        
        .admin-header h2 {
            margin: 0;
            font-size: 32px;
            font-weight: 800;
            position: relative;
            z-index: 1;
        }
        
        .admin-header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }
        
        /* Container */
        .admin-input-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Back to Home Button */
        .back-to-home {
            position: fixed;
            top: 20px;
            left: 20px;
            background: linear-gradient(135deg, #ffffff 0%, #f9fafb 100%);
            color: #667eea;
            padding: 12px 20px;
            border-radius: 12px;
            text-decoration: none;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
            border: 2px solid #e5e7eb;
            z-index: 1000;
        }
        
        .back-to-home:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-3px) translateX(-5px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }
        
        .back-to-home i {
            transition: transform 0.3s ease;
        }
        
        .back-to-home:hover i {
            transform: translateX(-5px);
        }
        
        /* Quick Input Button */
        .quick-input-btn {
            position: fixed;
            top: 20px;
            left: 200px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 12px 20px;
            border-radius: 12px;
            text-decoration: none;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.3);
            transition: all 0.3s ease;
            border: 2px solid #10b981;
            z-index: 1000;
        }
        
        .quick-input-btn:hover {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 10px 30px rgba(16, 185, 129, 0.5);
        }
        
        .quick-input-btn i {
            animation: pulse 2s ease-in-out infinite;
        }
        
        /* Form Row */
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        /* Form Group */
        .form-group {
            margin-bottom: 20px;
        }
        
        /* Select styling */
        .form-select,
        select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath fill='%23667eea' d='M6 8L0 0h12z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 16px center;
            padding-right: 45px;
        }
        
        /* Textarea styling */
        .form-textarea,
        textarea {
            font-family: inherit;
            line-height: 1.6;
        }
        
        /* Admin form container */
        .admin-form-container {
            animation: fadeInUp 0.8s ease;
        }
        
        .product-form {
            position: relative;
        }
        
        /* Header Icon */
        .header-icon {
            font-size: 48px;
            margin-bottom: 15px;
            animation: bounceIn 1s ease;
        }
        
        .header-icon i {
            color: rgba(255, 255, 255, 0.9);
            animation: pulse 3s ease-in-out infinite;
        }
        
        .admin-header h1 {
            margin: 0 0 10px 0;
            font-size: 36px;
            font-weight: 900;
            letter-spacing: 1px;
            position: relative;
            z-index: 1;
            color: #ffffff;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        .admin-header p {
            color: rgba(255, 255, 255, 0.95);
            font-size: 16px;
            text-shadow: 0 1px 5px rgba(0, 0, 0, 0.15);
        }
        
        /* Add fancy scrollbar */
        ::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f3f4f6;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            border: 2px solid #f3f4f6;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
        }
        
        /* Responsive */
        @media (max-width: 992px) {
            body.admin-input-page::before,
            body.admin-input-page::after {
                font-size: 40px;
            }
            
            .admin-header h2 {
                font-size: 28px;
            }
            
            .quick-input-btn {
                left: 20px;
                top: 80px;
                font-size: 14px;
                padding: 10px 16px;
            }
            
            .form-section,
            .image-upload-section,
            .specs-section {
                padding: 20px;
            }
            
            .spec-row {
                flex-direction: column;
                align-items: stretch;
            }
        }
        
        @media (max-width: 768px) {
            body.admin-input-page {
                padding: 10px;
            }
            
            .back-to-home {
                left: 10px;
                padding: 10px 16px;
                font-size: 14px;
            }
            
            .quick-input-btn {
                left: 10px;
                top: 70px;
                padding: 10px 16px;
                font-size: 13px;
            }
            
            .admin-header {
                padding: 20px;
                margin-bottom: 20px;
            }
            
            .admin-header h2 {
                font-size: 24px;
            }
            
            .admin-header::before {
                font-size: 100px;
            }
            
            #variantActions {
                flex-direction: column;
            }
            
            .create-variant-btn, .view-variants-btn {
                justify-content: center;
                width: 100%;
            }
            
            .attribute-row .form-row {
                flex-direction: column;
                gap: 10px;
            }
            
            .remove-attr-btn {
                margin-left: 0;
                align-self: flex-end;
            }
            
            .variant-forms-container {
                max-height: 400px;
            }
            
            .single-variant-form {
                padding: 15px;
            }
            
            .form-input,
            input[type="text"],
            input[type="number"],
            input[type="email"],
            select,
            textarea {
                padding: 12px 14px;
                font-size: 14px;
            }
            
            button[type="submit"],
            .submit-btn {
                padding: 14px 24px;
                font-size: 15px;
            }
            
            .image-upload-area {
                padding: 30px 20px;
            }
            
            .upload-icon {
                font-size: 3rem;
            }
            
            .image-preview {
                grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
                gap: 10px;
                padding: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .form-section h3,
            .image-upload-section h3,
            .specs-section h3 {
                font-size: 18px;
            }
            
            .variant-form-header h4 {
                font-size: 16px;
            }
            
            .info-card {
                flex-direction: column;
                text-align: center;
            }
            
            .info-card i {
                font-size: 28px;
            }
            
            button[type="submit"],
            .submit-btn {
                padding: 12px 20px;
                font-size: 14px;
            }
            
            .add-spec-btn,
            .create-variant-btn,
            .view-variants-btn {
                padding: 12px 20px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body class="admin-input-page">
    <!-- Back to Home Button -->
    <a href="/" class="back-to-home">
        <i class="fas fa-arrow-left"></i> Vá» Trang Chá»§
    </a>

    <!-- Quick Input Button -->
    <a href="javascript:void(0)" onclick="navigateToAdmin('/admin/quick-input'); return false;" class="quick-input-btn" title="ThÃªm nhanh nhiá»u sáº£n pháº©m cÃ¹ng lÃºc">
        <i class="fas fa-bolt"></i> Nháº­p Nhanh
    </a>

    <div class="admin-input-container">
        <!-- Admin Header -->
        <div class="admin-header">
            <div class="header-icon">
                <i class="fas fa-plus-circle"></i>
            </div>
            <h1>THÃŠM Sáº¢N PHáº¨M Má»šI</h1>
            <p>Quáº£n lÃ½ kho hÃ ng TECH HAVEN - ThÃªm sáº£n pháº©m cÃ´ng nghá»‡ má»›i</p>
        </div>

        <!-- Main Form Container -->
        <div class="admin-form-container">
            <form id="productForm" class="product-form" enctype="multipart/form-data">
                <!-- Messages -->
                <div id="successMessage" class="message success" style="display: none;">
                    <div class="message-content">
                        <i class="fas fa-check-circle"></i>
                        <div class="message-text">
                            <span>Sáº£n pháº©m Ä‘Ã£ Ä‘Æ°á»£c thÃªm thÃ nh cÃ´ng!</span>
                            <div class="message-actions">
                                <button type="button" class="btn-success-action" onclick="resetForm()">
                                    <i class="fas fa-plus"></i> ThÃªm sáº£n pháº©m má»›i
                                </button>
                                <button type="button" class="btn-success-action" onclick="goToShop()">
                                    <i class="fas fa-eye"></i> Xem cá»­a hÃ ng
                                </button>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn-close-message" onclick="hideSuccessMessage()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div id="errorMessage" class="message error" style="display: none;">
                    <i class="fas fa-exclamation-circle"></i>
                    <span id="errorText">CÃ³ lá»—i xáº£y ra!</span>
                </div>

                <!-- Basic Information Section -->
                <div class="form-section">
                    <h3><i class="fas fa-info-circle"></i> ThÃ´ng Tin CÆ¡ Báº£n</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>TÃªn Sáº£n Pháº©m *</label>
                            <input type="text" id="productName" class="form-input" placeholder="VD: ASUS ROG Strix G15 Gaming Laptop" required>
                        </div>
                        <div class="form-group">
                            <label>Danh Má»¥c *</label>
                            <select id="productCategory" class="form-select" required>
                                <option value="">Chá»n danh má»¥c</option>
                                <option value="laptop">Laptop</option>
                                <option value="pc">PC</option>
                                <option value="gpu">Card Äá»“ Há»a</option>
                                <option value="cpu">Bá»™ Vi Xá»­ LÃ½</option>
                                <option value="ram">Bá»™ Nhá»› RAM</option>
                                <option value="storage">á»” Cá»©ng</option>
                                <option value="motherboard">Bo Máº¡ch Chá»§</option>
                                <option value="psu">Nguá»“n</option>
                                <option value="case">Vá» Case</option>
                                <option value="keyboard">BÃ n PhÃ­m</option>
                                <option value="mouse">Chuá»™t</option>
                                <option value="headset">Tai Nghe</option>
                                <option value="monitor">MÃ n HÃ¬nh</option>
                                <option value="speaker">Loa</option>
                                <option value="webcam">Webcam</option>
                                <option value="other">KhÃ¡c</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>ThÆ°Æ¡ng Hiá»‡u *</label>
                            <input type="text" id="productBrand" class="form-input" placeholder="VD: ASUS, MSI, Intel, AMD..." required>
                        </div>
                        <div class="form-group">
                            <label>MÃ£ Sáº£n Pháº©m (SKU)</label>
                            <input type="text" id="productSku" class="form-input" placeholder="VD: G513QM-HN015T">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>MÃ´ Táº£ Chi Tiáº¿t</label>
                        <textarea id="productDescription" class="form-textarea" placeholder="Nháº­p mÃ´ táº£ chi tiáº¿t vá» sáº£n pháº©m..."></textarea>
                    </div>
                </div>

                <!-- Pricing & Stock Section -->
                <div class="form-section">
                    <h3><i class="fas fa-dollar-sign"></i> GiÃ¡ Cáº£ & Tá»“n Kho</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>GiÃ¡ BÃ¡n (VNÄ) *</label>
                            <input type="number" id="productPrice" class="form-input" placeholder="VD: 35990000" required min="0">
                        </div>
                        <div class="form-group">
                            <label>GiÃ¡ CÅ© (Ä‘á»ƒ táº¡o nhÃ£n giáº£m giÃ¡)</label>
                            <input type="number" id="productOldPrice" class="form-input" placeholder="VD: 39990000 (Ä‘á»ƒ táº¡o nhÃ£n giáº£m giÃ¡)" min="0">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Sá»‘ LÆ°á»£ng Tá»“n Kho *</label>
                            <input type="number" id="productStock" class="form-input" placeholder="VD: 50" required min="0">
                        </div>
                        <div class="form-group">
                            <label>Tráº¡ng ThÃ¡i *</label>
                            <select id="productAvailability" class="form-select" required>
                                <option value="">Chá»n tráº¡ng thÃ¡i</option>
                                <option value="in-stock">CÃ²n hÃ ng</option>
                                <option value="out-of-stock">Háº¿t hÃ ng</option>
                                <option value="pre-order">Äáº·t trÆ°á»›c</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Image Upload Section -->
                <div class="form-section image-upload-section">
                    <h3><i class="fas fa-images"></i> HÃ¬nh áº¢nh Sáº£n Pháº©m</h3>
                    
                    <div class="image-upload-area" onclick="document.getElementById('imageInput').click()">
                        <div class="upload-icon">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <div class="upload-text">
                            <h4>Táº£i lÃªn hÃ¬nh áº£nh sáº£n pháº©m</h4>
                            <p>KÃ©o tháº£ hoáº·c click Ä‘á»ƒ chá»n áº£nh (tá»‘i Ä‘a 10 áº£nh, má»—i áº£nh â‰¤ 5MB)</p>
                        </div>
                        <input type="file" id="imageInput" accept="image/*" multiple style="display: none;">
                    </div>
                    
                    <div id="imagePreview" class="image-preview" style="display: none;"></div>
                    
                    <div id="uploadProgress" class="upload-progress" style="display: none;">
                        <div class="progress-text">Äang chuáº©n bá»‹...</div>
                        <div id="progressFill" class="progress-fill" style="width: 0%;"></div>
                    </div>
                </div>

                <!-- Technical Specifications Section -->
                <div class="form-section specs-section">
                    <h3><i class="fas fa-cogs"></i> ThÃ´ng Sá»‘ Ká»¹ Thuáº­t</h3>
                    
                    <div id="specInputs" class="spec-inputs">
                        <!-- Spec rows will be added dynamically -->
                    </div>
                    
                    <button type="button" class="add-spec-btn" onclick="addSpecRow()">
                        <i class="fas fa-plus"></i> ThÃªm ThÃ´ng Sá»‘
                    </button>
                </div>

                <!-- Features Section -->
                <div class="form-section features-section">
                    <h3><i class="fas fa-star"></i> TÃ­nh NÄƒng Ná»•i Báº­t</h3>
                    
                    <div id="featureInputs" class="feature-inputs">
                        <!-- Feature rows will be added dynamically -->
                    </div>
                    
                    <button type="button" class="add-feature-btn" onclick="addFeatureRow()">
                        <i class="fas fa-plus"></i> ThÃªm TÃ­nh NÄƒng
                    </button>
                </div>

                <!-- Product Variants Section -->
                <div class="form-section">
                    <h3><i class="fas fa-layer-group"></i> Quáº£n LÃ½ Biáº¿n Thá»ƒ</h3>
                    
                    <div class="variant-controls">
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="isVariant" onchange="toggleVariantMode()">
                                <span class="checkmark"></span>
                                Sáº£n pháº©m cÃ³ biáº¿n thá»ƒ (mÃ u sáº¯c, kÃ­ch thÆ°á»›c, cáº¥u hÃ¬nh khÃ¡c...)
                            </label>
                        </div>
                        
                        <!-- Hidden field for parent product ID when creating variants -->
                        <input type="hidden" id="parentProductId" value="">
                        
                        <!-- Parent product info (shown when creating variant) -->
                        <div id="parentProductInfo" style="display: none;" class="parent-product-info">
                            <div class="info-card">
                                <i class="fas fa-info-circle"></i>
                                <div class="info-content">
                                    <h4>Táº¡o biáº¿n thá»ƒ cho sáº£n pháº©m</h4>
                                    <p id="parentProductName">Sáº£n pháº©m gá»‘c: Loading...</p>
                                    <small>Biáº¿n thá»ƒ nÃ y sáº½ káº¿ thá»«a thÃ´ng tin cÆ¡ báº£n tá»« sáº£n pháº©m gá»‘c</small>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Workflow instructions -->
                        <div id="variantInstructions" style="display: none; margin-top: 15px; padding: 15px; background: #f0f9ff; border: 1px solid #0ea5e9; border-radius: 8px; color: #0c4a6e;">
                            <h5 style="margin: 0 0 10px 0; color: #0c4a6e;"><i class="fas fa-info-circle"></i> Quy trÃ¬nh táº¡o biáº¿n thá»ƒ</h5>
                            <p style="margin: 0 0 10px 0; font-size: 14px;">
                                <strong>BÆ°á»›c 1:</strong> Äiá»n thÃ´ng tin sáº£n pháº©m chÃ­nh vÃ  nháº¥n "THÃŠM Sáº¢N PHáº¨M" Ä‘á»ƒ táº¡o sáº£n pháº©m gá»‘c<br>
                                <strong>BÆ°á»›c 2:</strong> Sau khi táº¡o thÃ nh cÃ´ng, sá»­ dá»¥ng nÃºt "Táº¡o Biáº¿n Thá»ƒ Má»›i" Ä‘á»ƒ thÃªm cÃ¡c biáº¿n thá»ƒ
                            </p>
                        </div>
                        
                        <!-- Variant quantity selector -->
                        <div id="variantQuantitySelector" style="display: none; margin-top: 15px; padding: 15px; background: #f8fafc; border-radius: 8px; border: 2px solid #10b981;">
                            <div class="form-group">
                                <label style="color: #374151; font-weight: 500; margin-bottom: 8px;">Sá»‘ lÆ°á»£ng biáº¿n thá»ƒ cáº§n táº¡o:</label>
                                <input type="number" id="variantQuantity" class="form-input" style="width: 120px;" min="1" max="10" value="2" placeholder="VD: 3">
                                <small style="color: #6b7280; margin-left: 10px;">Tá»‘i Ä‘a 10 biáº¿n thá»ƒ</small>
                            </div>
                            <p style="margin: 10px 0 0 0; font-size: 14px; color: #6b7280;">
                                <i class="fas fa-info-circle"></i> Sau khi táº¡o sáº£n pháº©m chÃ­nh, há»‡ thá»‘ng sáº½ tá»± Ä‘á»™ng táº¡o form cho cÃ¡c biáº¿n thá»ƒ
                            </p>
                        </div>
                        
                        <!-- Variant creation button (for main products) -->
                        <div id="variantActions" style="display: none;">
                            <button type="button" class="view-variants-btn" onclick="viewExistingVariants()">
                                <i class="fas fa-list"></i> Xem CÃ¡c Biáº¿n Thá»ƒ
                            </button>
                        </div>
                    </div>
                    
                    <!-- Multiple Variant Forms Container (shown after main product creation) -->
                    <div id="multipleVariantForms" class="multiple-variant-forms" style="display: none; margin-top: 20px;">
                        <div class="variant-forms-header" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; padding: 15px 20px; border-radius: 12px 12px 0 0;">
                            <h4 style="margin: 0; display: flex; align-items: center; gap: 8px;">
                                <i class="fas fa-layer-group"></i> Táº¡o <span id="variantCount">2</span> Biáº¿n Thá»ƒ
                            </h4>
                            <p style="margin: 5px 0 0 0; font-size: 14px; opacity: 0.9;">Äiá»n thÃ´ng tin cho tá»«ng biáº¿n thá»ƒ dá»±a trÃªn sáº£n pháº©m gá»‘c</p>
                        </div>
                        <div id="variantFormsContainer" class="variant-forms-container">
                            <!-- Variant forms will be generated here -->
                        </div>
                        <div class="variant-forms-footer" style="background: #f8fafc; padding: 15px 20px; border-radius: 0 0 12px 12px; text-align: center;">
                            <button type="button" class="submit-variants-btn" onclick="submitAllVariants()" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; padding: 12px 24px; border-radius: 8px; font-weight: 500;">
                                <i class="fas fa-save"></i> LÆ°u Táº¥t Cáº£ Biáº¿n Thá»ƒ
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Submit Section -->
                <div class="submit-section">
                    <button type="submit" id="submitBtn" class="submit-btn">
                        <i class="fas fa-save"></i> THÃŠM Sáº¢N PHáº¨M
                    </button>
                    <div id="loadingSpinner" class="loading-spinner" style="display: none;"></div>
                </div>
            </form>
        </div>
    </div>

    <!-- Scripts -->
    <script type="module" src="/js/firebase-config.js"></script>
    <script type="module" src="/js/input-admin.js"></script>
    
    <script>
        // Variant Management Functions
        let variantAttributes = [];

        // Note: toggleVariantMode function is now defined in input-admin.js
        // This avoids conflicts and ensures proper handling of all variant UI elements
        
        console.log('ðŸš€ Variant management JavaScript loaded successfully!');
        
        /*
        // Commented out broken JavaScript code - replaced by input-admin.js
        /*
            console.log('ï¿½ Element check:');
            console.log('- variantInstructions:', variantInstructions ? 'FOUND' : 'NOT FOUND');
            console.log('- variantQuantitySelector:', variantQuantitySelector ? 'FOUND' : 'NOT FOUND');
            console.log('- variantActions:', variantActions ? 'FOUND' : 'NOT FOUND');
            
            if (isVariant) {
                console.log('âœ… ENABLING variant mode...');
                
                // Show instructions
                if (variantInstructions) {
                    variantInstructions.style.display = 'block';
                    console.log('âœ… Instructions shown');
                }
                
                // Show quantity selector when variant mode is enabled
                if (variantQuantitySelector) {
                    variantQuantitySelector.style.display = 'block';
                    variantQuantitySelector.style.visibility = 'visible';
                    console.log('âœ… Quantity selector shown');
                }
                
                // Keep actions hidden until main product is created
                if (variantActions) {
                    variantActions.style.display = 'none';
                    console.log('â³ Actions remain hidden');
                }
                
            } else {
                console.log('âŒ DISABLING variant mode...');
                
                // Hide all variant sections immediately
                if (variantInstructions) {
                    variantInstructions.style.display = 'none';
                    console.log('âŒ Instructions hidden');
                }
                
                if (variantQuantitySelector) {
                    variantQuantitySelector.style.display = 'none';
                    console.log('âŒ Quantity selector hidden');
                }
                
                if (variantActions) {
                    variantActions.style.display = 'none';
                    console.log('âŒ Actions hidden');
                }
                
                if (multipleVariantForms) {
                    multipleVariantForms.style.display = 'none';
                    console.log('âŒ Forms hidden');
                }
                
                // Reset values
                const parentIdInput = document.getElementById('parentProductId');
                if (parentIdInput) parentIdInput.value = '';
                
                const variantQuantityInput = document.getElementById('variantQuantity');
                if (variantQuantityInput) variantQuantityInput.value = '2';
                
                // Clear variant forms
                window.createdMainProductId = null;
                window.mainProductData = null;
            }
        */

        // Open variant creator form
        window.openVariantCreator = function() {
            const variantForm = document.getElementById('variantForm');
            if (variantForm) {
                variantForm.style.display = 'block';
                
                // Pre-fill parent product info if available
                const urlParams = new URLSearchParams(window.location.search);
                const parentId = urlParams.get('parent_id');
                if (parentId) {
                    const parentIdInput = document.getElementById('parentProductId');
                    if (parentIdInput) {
                        parentIdInput.value = parentId;
                        loadParentProductInfo(parentId);
                    }
                }
                
                // Initialize with one attribute row
                if (variantAttributes.length === 0) {
                    addAttributeRow();
                }
            }
        };

        // Close variant creator form
        window.closeVariantForm = function() {
            const variantForm = document.getElementById('variantForm');
            if (variantForm) {
                variantForm.style.display = 'none';
            }
            
            // Clear form data
            const fields = ['variantName', 'variantSku', 'variantPrice', 'variantStock'];
            fields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) field.value = '';
            });
            
            // Clear attributes
            variantAttributes = [];
            const attributeRows = document.getElementById('variantAttributes');
            if (attributeRows) {
                // Keep the existing structure, just remove the attribute rows
                const existingRows = attributeRows.querySelectorAll('.attribute-row');
                existingRows.forEach(row => row.remove());
            }
        };

        // Load parent product information
        async function loadParentProductInfo(parentId) {
            try {
                const response = await fetch(`/api/products/${parentId}`);
                if (response.ok) {
                    const product = await response.json();
                    const infoContent = document.querySelector('.parent-product-info .info-content');
                    if (infoContent) {
                        infoContent.innerHTML = `
                            <h4>${product.name}</h4>
                            <p>SKU: ${product.sku}</p>
                            <small>Táº¡o biáº¿n thá»ƒ cho sáº£n pháº©m nÃ y</small>
                        `;
                    }
                }
            } catch (error) {
                console.error('Error loading parent product:', error);
            }
        }

        // Add attribute row
        window.addAttributeRow = function() {
            const attributeId = 'attr_' + Date.now();
            const attributeRowsContainer = document.getElementById('variantAttributes');
            
            if (!attributeRowsContainer) {
                console.error('variantAttributes container not found');
                return;
            }
            
            const attributeRow = document.createElement('div');
            attributeRow.className = 'attribute-row';
            attributeRow.id = attributeId;
            
            attributeRow.innerHTML = `
                <div class="form-row">
                    <div class="form-group">
                        <label>TÃªn thuá»™c tÃ­nh:</label>
                        <input type="text" class="variant-attr-name" placeholder="VD: MÃ u sáº¯c, KÃ­ch thÆ°á»›c">
                    </div>
                    <div class="form-group">
                        <label>GiÃ¡ trá»‹:</label>
                        <input type="text" class="variant-attr-value" placeholder="VD: Äá», XL">
                    </div>
                    <button type="button" class="remove-attr-btn" onclick="removeAttributeRow('${attributeId}')">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
            
            attributeRowsContainer.appendChild(attributeRow);
            
            // Add to attributes array
            variantAttributes.push({
                id: attributeId,
                name: '',
                value: ''
            });
        };

        // Remove attribute row
        window.removeAttributeRow = function(attributeId) {
            const row = document.getElementById(attributeId);
            if (row) {
                row.remove();
                
                // Remove from attributes array
                variantAttributes = variantAttributes.filter(attr => attr.id !== attributeId);
            }
        };

        // Collect variant attributes before form submission
        function collectVariantAttributes() {
            const attributeRows = document.querySelectorAll('.attribute-row');
            const attributes = {};
            
            attributeRows.forEach(row => {
                const nameInput = row.querySelector('.variant-attr-name');
                const valueInput = row.querySelector('.variant-attr-value');
                
                if (nameInput && valueInput && nameInput.value.trim() && valueInput.value.trim()) {
                    attributes[nameInput.value.trim()] = valueInput.value.trim();
                }
            });
            
            return attributes;
        }

        // Global variable to store created main product ID
        window.createdMainProductId = null;
        
        // Generate variant forms after main product creation
        window.generateVariantForms = function(mainProductId, mainProductData) {
            const variantQuantity = parseInt(document.getElementById('variantQuantity').value) || 2;
            const variantCount = document.getElementById('variantCount');
            const variantFormsContainer = document.getElementById('variantFormsContainer');
            const multipleVariantForms = document.getElementById('multipleVariantForms');
            
            // Update count
            if (variantCount) variantCount.textContent = variantQuantity;
            
            // Clear existing forms
            if (variantFormsContainer) variantFormsContainer.innerHTML = '';
            
            // Store main product data
            window.createdMainProductId = mainProductId;
            window.mainProductData = mainProductData;
            
            // Generate forms
            for (let i = 1; i <= variantQuantity; i++) {
                const variantForm = createSingleVariantForm(i, mainProductData);
                variantFormsContainer.appendChild(variantForm);
            }
            
            // Show the forms container
            if (multipleVariantForms) multipleVariantForms.style.display = 'block';
            
            // Scroll to forms
            multipleVariantForms.scrollIntoView({ behavior: 'smooth' });
        };
        
        // Create single variant form
        function createSingleVariantForm(index, mainProductData) {
            const formDiv = document.createElement('div');
            formDiv.className = 'single-variant-form';
            formDiv.id = `variantForm${index}`;
            
            formDiv.innerHTML = `
                <div class="variant-form-title">
                    <i class="fas fa-tag"></i> Biáº¿n Thá»ƒ ${index}
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>TÃªn Biáº¿n Thá»ƒ *</label>
                        <input type="text" class="variant-name" placeholder="VD: ${mainProductData.name} - MÃ u Äá»" value="${mainProductData.name} - Biáº¿n thá»ƒ ${index}">
                    </div>
                    <div class="form-group">
                        <label>MÃ£ SKU Biáº¿n Thá»ƒ</label>
                        <input type="text" class="variant-sku" placeholder="VD: ${mainProductData.sku}-V${index}" value="${mainProductData.sku}-V${index}">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>GiÃ¡ Biáº¿n Thá»ƒ (VNÄ) *</label>
                        <input type="number" class="variant-price" placeholder="CÃ³ thá»ƒ khÃ¡c giÃ¡ sáº£n pháº©m gá»‘c" value="${mainProductData.price}" min="0">
                    </div>
                    <div class="form-group">
                        <label>Tá»“n Kho Biáº¿n Thá»ƒ *</label>
                        <input type="number" class="variant-stock" placeholder="Sá»‘ lÆ°á»£ng riÃªng cá»§a biáº¿n thá»ƒ" value="${Math.floor(mainProductData.stock / 2)}" min="0">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>MÃ´ Táº£ KhÃ¡c Biá»‡t</label>
                    <textarea class="variant-description" placeholder="MÃ´ táº£ Ä‘iá»ƒm khÃ¡c biá»‡t cá»§a biáº¿n thá»ƒ nÃ y..."></textarea>
                </div>
                
                <!-- Variant Image Upload Section -->
                <div class="variant-image-section">
                    <h5><i class="fas fa-images"></i> HÃ¬nh áº¢nh Biáº¿n Thá»ƒ ${index}</h5>
                    <p style="font-size: 13px; color: #6b7280; margin-bottom: 10px;">
                        <i class="fas fa-info-circle"></i> Upload áº£nh riÃªng cho biáº¿n thá»ƒ nÃ y hoáº·c sá»­ dá»¥ng áº£nh sáº£n pháº©m gá»‘c
                    </p>
                    
                    <div class="variant-image-upload-area" onclick="document.getElementById('variantImageInput${index}').click()">
                        <input type="file" id="variantImageInput${index}" class="variant-image-input" accept="image/*" multiple style="display: none;" onchange="handleVariantImageSelection(${index}, event)">
                        <div class="variant-upload-icon">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <p><strong>Click Ä‘á»ƒ chá»n áº£nh</strong> hoáº·c kÃ©o tháº£ vÃ o Ä‘Ã¢y</p>
                        <p style="font-size: 12px; color: #9ca3af;">PNG, JPG, GIF tá»‘i Ä‘a 5MB - Tá»‘i Ä‘a 10 áº£nh</p>
                    </div>
                    
                    <div id="variantImagePreview${index}" class="variant-image-preview" style="display: none;"></div>
                    
                    <div class="use-main-images-option" style="margin-top: 15px;">
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; font-size: 14px;">
                            <input type="checkbox" id="useMainImages${index}" class="use-main-images-checkbox" onchange="toggleMainImages(${index})" style="width: 18px; height: 18px; accent-color: #10b981;">
                            <span><i class="fas fa-sync-alt"></i> Sá»­ dá»¥ng áº£nh tá»« sáº£n pháº©m gá»‘c (${mainProductData.images ? mainProductData.images.length : 0} áº£nh)</span>
                        </label>
                    </div>
                </div>
                
                <div class="variant-attributes">
                    <h5><i class="fas fa-tags"></i> Thuá»™c TÃ­nh Biáº¿n Thá»ƒ ${index}</h5>
                    <div class="variant-attributes-container">
                        <div class="attribute-row">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Thuá»™c TÃ­nh</label>
                                    <select class="variant-attr-name">
                                        <option value="">Chá»n thuá»™c tÃ­nh</option>
                                        <option value="color">MÃ u Sáº¯c</option>
                                        <option value="size">KÃ­ch ThÆ°á»›c</option>
                                        <option value="storage">Dung LÆ°á»£ng</option>
                                        <option value="ram">RAM</option>
                                        <option value="cpu">CPU</option>
                                        <option value="gpu">GPU</option>
                                        <option value="custom">KhÃ¡c...</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>GiÃ¡ Trá»‹</label>
                                    <input type="text" class="variant-attr-value" placeholder="VD: Äá», 128GB, 16GB RAM...">
                                </div>
                                <button type="button" class="remove-attr-btn" onclick="removeVariantAttribute(this)">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="add-attr-btn" onclick="addVariantAttribute(${index})">
                        <i class="fas fa-plus"></i> ThÃªm Thuá»™c TÃ­nh
                    </button>
                </div>
            `;
            
            return formDiv;
        }
        
        // Add attribute to specific variant
        window.addVariantAttribute = function(variantIndex) {
            const container = document.querySelector(`#variantForm${variantIndex} .variant-attributes-container`);
            if (!container) return;
            
            const attributeRow = document.createElement('div');
            attributeRow.className = 'attribute-row';
            attributeRow.innerHTML = `
                <div class="form-row">
                    <div class="form-group">
                        <label>Thuá»™c TÃ­nh</label>
                        <select class="variant-attr-name">
                            <option value="">Chá»n thuá»™c tÃ­nh</option>
                            <option value="color">MÃ u Sáº¯c</option>
                            <option value="size">KÃ­ch ThÆ°á»›c</option>
                            <option value="storage">Dung LÆ°á»£ng</option>
                            <option value="ram">RAM</option>
                            <option value="cpu">CPU</option>
                            <option value="gpu">GPU</option>
                            <option value="custom">KhÃ¡c...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>GiÃ¡ Trá»‹</label>
                        <input type="text" class="variant-attr-value" placeholder="VD: Äá», 128GB, 16GB RAM...">
                    </div>
                    <button type="button" class="remove-attr-btn" onclick="removeVariantAttribute(this)">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
            container.appendChild(attributeRow);
        };
        
        // Remove attribute from variant
        window.removeVariantAttribute = function(button) {
            const attributeRow = button.closest('.attribute-row');
            if (attributeRow) {
                attributeRow.remove();
            }
        };
        
        // Store variant images for each variant
        window.variantImages = {};
        
        // Handle variant image selection
        window.handleVariantImageSelection = function(variantIndex, event) {
            const files = Array.from(event.target.files);
            processVariantImageFiles(variantIndex, files);
        };
        
        // Process variant image files
        function processVariantImageFiles(variantIndex, files) {
            // Validate file size and type
            const validFiles = files.filter(file => {
                if (!file.type.startsWith('image/')) {
                    alert('Chá»‰ há»— trá»£ file hÃ¬nh áº£nh (JPG, PNG, GIF)');
                    return false;
                }
                if (file.size > 5 * 1024 * 1024) {
                    alert(`File ${file.name} quÃ¡ lá»›n. Giá»›i háº¡n 5MB.`);
                    return false;
                }
                return true;
            });
            
            if (validFiles.length === 0) return;
            
            // Initialize array if not exists
            if (!window.variantImages[variantIndex]) {
                window.variantImages[variantIndex] = [];
            }
            
            // Limit to 10 images total
            const totalImages = window.variantImages[variantIndex].length + validFiles.length;
            if (totalImages > 10) {
                alert('Tá»‘i Ä‘a 10 hÃ¬nh áº£nh cho má»—i biáº¿n thá»ƒ');
                return;
            }
            
            // Add to variant images array
            window.variantImages[variantIndex] = [...window.variantImages[variantIndex], ...validFiles];
            
            // Update preview
            updateVariantImagePreview(variantIndex);
            
            // Uncheck "use main images" if checked
            const useMainCheckbox = document.getElementById(`useMainImages${variantIndex}`);
            if (useMainCheckbox) {
                useMainCheckbox.checked = false;
            }
        }
        
        // Update variant image preview
        function updateVariantImagePreview(variantIndex) {
            const preview = document.getElementById(`variantImagePreview${variantIndex}`);
            if (!preview) return;
            
            preview.innerHTML = '';
            
            const images = window.variantImages[variantIndex] || [];
            if (images.length === 0) {
                preview.style.display = 'none';
                return;
            }
            
            preview.style.display = 'grid';
            
            images.forEach((file, imageIndex) => {
                const previewItem = document.createElement('div');
                previewItem.className = 'variant-preview-item';
                
                const img = document.createElement('img');
                img.className = 'variant-preview-image';
                img.src = URL.createObjectURL(file);
                img.alt = `Variant ${variantIndex} - Image ${imageIndex + 1}`;
                
                const removeBtn = document.createElement('button');
                removeBtn.className = 'variant-remove-image';
                removeBtn.innerHTML = '<i class="fas fa-times"></i>';
                removeBtn.onclick = (e) => {
                    e.stopPropagation();
                    removeVariantImage(variantIndex, imageIndex);
                };
                
                previewItem.appendChild(img);
                previewItem.appendChild(removeBtn);
                preview.appendChild(previewItem);
            });
        }
        
        // Remove variant image
        function removeVariantImage(variantIndex, imageIndex) {
            if (window.variantImages[variantIndex]) {
                window.variantImages[variantIndex].splice(imageIndex, 1);
                updateVariantImagePreview(variantIndex);
            }
        }
        
        // Toggle use main images
        window.toggleMainImages = function(variantIndex) {
            const checkbox = document.getElementById(`useMainImages${variantIndex}`);
            const imageInput = document.getElementById(`variantImageInput${variantIndex}`);
            
            if (checkbox.checked) {
                // Clear variant-specific images
                window.variantImages[variantIndex] = [];
                updateVariantImagePreview(variantIndex);
                
                // Disable image input
                if (imageInput) {
                    imageInput.disabled = true;
                }
                
                console.log(`Variant ${variantIndex} will use main product images`);
            } else {
                // Enable image input
                if (imageInput) {
                    imageInput.disabled = false;
                }
            }
        };
        
        // Submit all variants
        window.submitAllVariants = async function() {
            const variantForms = document.querySelectorAll('.single-variant-form');
            const variants = [];
            
            console.log('ðŸš€ Starting variant submission...');
            console.log('ðŸ“Š Number of variants:', variantForms.length);
            
            // Import Firebase modules
            const { getStorage, ref, uploadBytes, getDownloadURL } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js');
            const storage = getStorage();
            
            // Collect data from all forms
            for (let i = 0; i < variantForms.length; i++) {
                const form = variantForms[i];
                const variantIndex = i + 1;
                
                console.log(`\nðŸ“¦ Processing variant ${variantIndex}...`);
                
                const variantData = {
                    name: form.querySelector('.variant-name').value.trim(),
                    sku: form.querySelector('.variant-sku').value.trim(),
                    price: parseFloat(form.querySelector('.variant-price').value),
                    stock: parseInt(form.querySelector('.variant-stock').value),
                    description: form.querySelector('.variant-description').value.trim(),
                    attributes: {},
                    images: []
                };
                
                console.log(`  â”œâ”€ Name: ${variantData.name}`);
                console.log(`  â”œâ”€ Price: ${variantData.price}`);
                console.log(`  â””â”€ Stock: ${variantData.stock}`);
                
                // Collect attributes
                const attrRows = form.querySelectorAll('.attribute-row');
                attrRows.forEach(row => {
                    const nameInput = row.querySelector('.variant-attr-name');
                    const valueInput = row.querySelector('.variant-attr-value');
                    
                    if (nameInput && valueInput && nameInput.value.trim() && valueInput.value.trim()) {
                        variantData.attributes[nameInput.value.trim()] = valueInput.value.trim();
                        console.log(`  â”œâ”€ Attribute: ${nameInput.value.trim()} = ${valueInput.value.trim()}`);
                    }
                });
                
                // Handle images
                const useMainImages = document.getElementById(`useMainImages${variantIndex}`);
                
                if (useMainImages && useMainImages.checked) {
                    // Use main product images
                    console.log(`  â””â”€ ðŸ–¼ï¸ Using main product images`);
                    variantData.images = window.mainProductData.images || [];
                } else if (window.variantImages[variantIndex] && window.variantImages[variantIndex].length > 0) {
                    // Upload variant-specific images
                    console.log(`  â””â”€ ðŸ“¤ Uploading ${window.variantImages[variantIndex].length} variant images...`);
                    
                    const imageUrls = [];
                    for (let j = 0; j < window.variantImages[variantIndex].length; j++) {
                        const file = window.variantImages[variantIndex][j];
                        const filename = `products/variants/${Date.now()}_v${variantIndex}_${j}_${file.name}`;
                        const storageRef = ref(storage, filename);
                        
                        try {
                            const snapshot = await uploadBytes(storageRef, file);
                            const downloadURL = await getDownloadURL(snapshot.ref);
                            imageUrls.push(downloadURL);
                            console.log(`     âœ… Image ${j + 1} uploaded`);
                        } catch (error) {
                            console.error(`     âŒ Error uploading image ${j + 1}:`, error);
                            alert(`Lá»—i upload áº£nh ${file.name}: ${error.message}`);
                            return;
                        }
                    }
                    variantData.images = imageUrls;
                } else {
                    // No images - use main product images as fallback
                    console.log(`  â””â”€ âš ï¸ No images selected, using main product images as fallback`);
                    variantData.images = window.mainProductData.images || [];
                }
                
                console.log(`  â””â”€ ðŸ“¸ Total images: ${variantData.images.length}`);
                variants.push(variantData);
            }
            
            console.log('\nâœ… All variants processed, submitting to server...');
            
            // Submit variants to server
            submitVariantsToServer(variants);
        };
        
        // Submit main product first, then show variant forms (legacy - using input-admin.js now)
        window.submitMainProductWithVariants = async function(formData) {
            console.log('Deprecated: Use handleMainProductWithVariants in input-admin.js instead');
        };
        
        // Submit variants to server using same pattern as main products
        async function submitVariantsToServer(variants) {
            try {
                console.log('Submitting variants:', variants);
                
                // Import Firebase functions directly (same as input-admin.js)
                const { initializeApp, getApps, getApp } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js');
                const { getFirestore, collection, addDoc, serverTimestamp } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
                
                // Use existing Firebase app or create new one
                let app;
                if (getApps().length === 0) {
                    // Firebase config (same as input-admin.js)
                    const firebaseConfig = {
                        apiKey: "AIzaSyDpzgsxZ1Jfs5hWAfS-gDbYfgkVte_jXoA",
                        authDomain: "tech-haven-5368b.firebaseapp.com",
                        projectId: "tech-haven-5368b",
                        storageBucket: "tech-haven-5368b.firebasestorage.app",
                        messagingSenderId: "442337591630",
                        appId: "1:442337591630:web:7005525c7664f513a55e1f",
                        measurementId: "G-N54V96PG4M"
                    };
                    
                    app = initializeApp(firebaseConfig);
                    console.log('New Firebase app initialized for variants');
                } else {
                    app = getApp();
                    console.log('Using existing Firebase app for variants');
                }
                
                const db = getFirestore(app);
                
                console.log('Firebase initialized successfully for variants');
                
                // Submit each variant to Firebase
                for (const variant of variants) {
                    // Prepare variant data with parent reference
                    const variantData = {
                        ...window.mainProductData,
                        ...variant,
                        has_variant: true,
                        parent_id_product: window.createdMainProductId,
                        variant_attributes: variant.attributes,
                        status: window.mainProductData.availability || 'in-stock' // Use main product's availability status
                    };
                    
                    // Submit directly to Firebase
                    const docRef = await addDoc(collection(db, 'products'), {
                        ...variantData,
                        createdAt: serverTimestamp(),
                        updatedAt: serverTimestamp()
                    });
                    
                    console.log('Variant created with ID:', docRef.id);
                }
                
                alert(`ÄÃ£ táº¡o thÃ nh cÃ´ng ${variants.length} biáº¿n thá»ƒ!`);
                
                // Hide variant forms and reset
                document.getElementById('multipleVariantForms').style.display = 'none';
                
                // Optionally reset form
                if (confirm('Báº¡n cÃ³ muá»‘n táº¡o sáº£n pháº©m má»›i?')) {
                    window.location.reload();
                }
                
            } catch (error) {
                console.error('Error creating variants:', error);
                alert('CÃ³ lá»—i xáº£y ra khi táº¡o biáº¿n thá»ƒ: ' + error.message);
            }
        }
        
        // View existing variants (placeholder)
        window.viewExistingVariants = function() {
            // This would open a modal or navigate to variants list
            alert('TÃ­nh nÄƒng xem biáº¿n thá»ƒ sáº½ Ä‘Æ°á»£c phÃ¡t triá»ƒn trong phiÃªn báº£n tiáº¿p theo');
        };

        // Test function - manually trigger variant mode for testing
        window.testVariantMode = function() {
            console.log('ðŸ§ª Testing variant mode manually...');
            const checkbox = document.getElementById('isVariant');
            if (checkbox) {
                checkbox.checked = !checkbox.checked;
                toggleVariantMode();
            } else {
                console.error('âŒ Checkbox not found for testing');
            }
        };

        // Initialize variant functionality when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ðŸš€ DOM Content Loaded - Setting up variant functionality');
            
            // Double-check that elements exist
            const isVariantCheckbox = document.getElementById('isVariant');
            const variantQuantitySelector = document.getElementById('variantQuantitySelector');
            const variantInstructions = document.getElementById('variantInstructions');
            
            console.log('ðŸ” Initial element check:');
            console.log('- Checkbox:', isVariantCheckbox ? 'FOUND' : 'NOT FOUND');
            console.log('- Quantity Selector:', variantQuantitySelector ? 'FOUND' : 'NOT FOUND'); 
            console.log('- Instructions:', variantInstructions ? 'FOUND' : 'NOT FOUND');
            
            // Add direct event listener as backup
            if (isVariantCheckbox) {
                isVariantCheckbox.addEventListener('change', function() {
                    console.log('ðŸ“‹ Checkbox change detected via addEventListener');
                    toggleVariantMode();
                });
                console.log('âœ… Event listener added to checkbox');
            }
            
            // Check if we're creating a variant from URL parameter
            const urlParams = new URLSearchParams(window.location.search);
            const parentId = urlParams.get('parent_id');
            
            if (parentId) {
                // Auto-check variant mode and load parent info
                if (isVariantCheckbox) {
                    isVariantCheckbox.checked = true;
                    toggleVariantMode();
                }
            }
            
            // Add test message
            console.log('ðŸ’¡ You can test variant mode by calling window.testVariantMode() in console');
            
            // Initialize features section
            addFeatureRow(); // Add first feature row
        });

        // Features management functions
        let featureCount = 0;

        function addFeatureRow() {
            featureCount++;
            const container = document.getElementById('featureInputs');
            
            const featureRow = document.createElement('div');
            featureRow.className = 'feature-row';
            featureRow.innerHTML = `
                <div class="form-group">
                    <input type="text" class="feature-title" placeholder="TiÃªu Ä‘á» tÃ­nh nÄƒng (VD: Hiá»‡u suáº¥t cao)" required>
                </div>
                <div class="form-group" style="flex: 2;">
                    <input type="text" class="feature-description" placeholder="MÃ´ táº£ chi tiáº¿t tÃ­nh nÄƒng (VD: CPU Intel i7 tháº¿ há»‡ 12 mang láº¡i hiá»‡u suáº¥t vÆ°á»£t trá»™i)" required>
                </div>
                <button type="button" class="remove-feature-btn" onclick="removeFeatureRow(this)">
                    <i class="fas fa-trash"></i>
                </button>
            `;
            
            container.appendChild(featureRow);
            
            // Add animation
            setTimeout(() => {
                featureRow.style.opacity = '1';
                featureRow.style.transform = 'translateX(0)';
            }, 100);
        }

        function removeFeatureRow(button) {
            const row = button.closest('.feature-row');
            row.style.animation = 'slideOutRight 0.3s ease';
            
            setTimeout(() => {
                row.remove();
                featureCount--;
                
                // Ensure at least one row
                if (featureCount === 0) {
                    addFeatureRow();
                }
            }, 300);
        }

        function collectFeatures() {
            const features = [];
            const featureRows = document.querySelectorAll('.feature-row');
            
            featureRows.forEach(row => {
                const title = row.querySelector('.feature-title').value.trim();
                const description = row.querySelector('.feature-description').value.trim();
                
                if (title && description) {
                    features.push({
                        title: title,
                        description: description,
                        icon: 'fas fa-star' // default icon
                    });
                }
            });
            
            return features;
        }

        // Success message action functions
        function resetForm() {
            // Reset the form to add new product
            document.getElementById('productForm').reset();
            
            // Reset image preview
            const imagePreview = document.getElementById('imagePreview');
            if (imagePreview) {
                imagePreview.innerHTML = '';
            }
            
            // Reset spec inputs
            const specInputs = document.getElementById('specInputs');
            if (specInputs) {
                specInputs.innerHTML = '';
                addSpecRow(); // Add one default spec row
            }
            
            // Reset feature inputs
            const featureInputs = document.getElementById('featureInputs');
            if (featureInputs) {
                featureInputs.innerHTML = '';
                addFeatureRow(); // Add one default feature row
            }
            
            // Reset variant mode
            const isVariantCheckbox = document.getElementById('isVariant');
            if (isVariantCheckbox) {
                isVariantCheckbox.checked = false;
                toggleVariantMode();
            }
            
            // Hide success message
            hideSuccessMessage();
            
            // Scroll to top
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
            
            console.log('âœ… Form reset for new product');
        }

        function goToShop() {
            // Redirect to shop page
            window.open('/shop', '_blank');
        }
    </script>

    <!-- Admin navigation function (same as revenue.js) -->
    <script type="module">
        import { getAuth } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        
        // Admin navigation function
        window.navigateToAdmin = async function(page) {
            console.log('ðŸš€ Navigating to admin page:', page);
            
            // Get the current auth token
            const auth = getAuth();
            const user = auth.currentUser;
            
            if (!user) {
                console.error('âŒ No user found');
                alert('âš ï¸ Vui lÃ²ng Ä‘Äƒng nháº­p Ä‘á»ƒ truy cáº­p trang admin');
                window.location.href = '/';
                return;
            }
            
            try {
                // Get fresh token
                const idToken = await user.getIdToken();
                
                // Check admin status from API
                console.log('ðŸ” Checking admin status from server...');
                const response = await fetch('/api/user', {
                    headers: {
                        'Authorization': `Bearer ${idToken}`,
                        'Accept': 'application/json'
                    },
                    credentials: 'include'
                });
                
                if (!response.ok) {
                    console.error('âŒ Failed to verify admin status:', response.status);
                    alert('âš ï¸ KhÃ´ng thá»ƒ xÃ¡c thá»±c quyá»n admin. Vui lÃ²ng Ä‘Äƒng nháº­p láº¡i.');
                    window.location.href = '/';
                    return;
                }
                
                const data = await response.json();
                console.log('ðŸ‘¤ User data from server:', data.user);
                
                const isAdmin = data.user && (data.user.is_admin === true || data.user.isAdmin === true);
                
                if (!isAdmin) {
                    console.error('âŒ User is not admin');
                    alert('âš ï¸ Báº¡n khÃ´ng cÃ³ quyá»n admin Ä‘á»ƒ truy cáº­p trang nÃ y');
                    return;
                }
                
                // Store user data
                if (data.user) {
                    localStorage.setItem('user', JSON.stringify(data.user));
                    localStorage.setItem('idToken', idToken);
                    console.log('ðŸ’¾ User data saved to localStorage');
                }
                
                console.log('âœ… Admin confirmed, navigating with token to:', page);
                window.location.href = `${page}?token=${encodeURIComponent(idToken)}`;
                
            } catch (error) {
                console.error('âŒ Error navigating to admin page:', error);
                alert('âš ï¸ CÃ³ lá»—i xáº£y ra. Vui lÃ²ng thá»­ láº¡i.');
            }
        };
    </script>
</body>
</html>